- hosts: all
  tasks:
    - name: "Install git"
      apt: name=git state=latest

    - name: "Download Pip installer"
      get_url: url=https://bootstrap.pypa.io/get-pip.py dest=/tmp/get-pip.py
      register: pipinstaller

    - name: "Install Python pip"
      command: python /tmp/get-pip.py
      when: pipinstaller|success
      register: pipinstalled

    - name: "Install Python nose"
      apt: name=python-nose state=latest
      register: noseinstalled

    - name: "Install required libraries"
      apt: name={{item}} state=latest
      with_items:
        - python-dev
        - libxml2-dev
        - libxslt1-dev
        - zlib1g-dev
        - python-libxml2
        - python-libxslt1
      register: libsinstalled

    - name: "Install buildtimetrend requirements"
      pip: requirements='/vagrant/requirements.txt'
      when: pipinstalled|success and libsinstalled|success

    - name: "Install buildtimetrend native requirements"
      pip: requirements='/vagrant/requirements_native.txt'
      when: pipinstalled|success and libsinstalled|success
