<!DOCTYPE html>
<html>

  <head>
    <meta charset='utf-8' />
    <meta http-equiv="X-UA-Compatible" content="chrome=1" />
    <meta name="description" content="Buildtime trend : Create a trendline of the different stages of a build process" />

    <link rel="stylesheet" type="text/css" media="screen" href="stylesheets/stylesheet.css">

    <title>Buildtime trend</title>
  </head>

  <body>

    <!-- HEADER -->
    <div id="header_wrap" class="outer">
        <header class="inner">
          <a id="forkme_banner" href="https://github.com/ruleant/buildtime-trend">View on GitHub</a>

          <h1 id="project_title">Buildtime trend</h1>
          <h2 id="project_tagline">Create a trendline of the different stages of a build process</h2>

            <section id="downloads">
              <a class="zip_download_link" href="https://github.com/ruleant/buildtime-trend/zipball/master">Download this project as a .zip file</a>
              <a class="tar_download_link" href="https://github.com/ruleant/buildtime-trend/tarball/master">Download this project as a tar.gz file</a>
            </section>
        </header>
    </div>

    <!-- MAIN CONTENT -->
    <div id="main_content_wrap" class="outer">
      <section id="main_content" class="inner">
        <h2>
<a name="build-stages-trend-example" class="anchor" href="#build-stages-trend-example"><span class="octicon octicon-link"></span></a>Build stages trend example</h2>

<p><img src="http://ruleant.github.io/buildtime-trend/buildtime-trend/trend.png" alt="build stages trend"></p>

<h2>
<a name="dependencies" class="anchor" href="#dependencies"><span class="octicon octicon-link"></span></a>Dependencies</h2>

<ul>
<li>keen (client for storing build time data as events in keen.io)</li>
<li>lxml (python wrapper for libxml2 and libxslt)</li>
<li>matplotlib v1.2.0 or higher (for drawing the trend graph, stackplot is introduced in v1.2.0)</li>
</ul><p>Install using pip :</p>

<p><code>pip install keen lxml 'matplotlib&gt;=1.2.0'</code></p>

<p>or as a Debian package :</p>

<p><code>apt-get install python-lxml python-matplotlib</code></p>

<h2>
<a name="usage" class="anchor" href="#usage"><span class="octicon octicon-link"></span></a>Usage</h2>

<p>First the timestamp recording needs to be initialised :</p>

<p><code>source /path/to/init.sh</code></p>

<p>This script will detect the location of the build-trend script folder,
adds it to the PATH and cleans logfiles of previous runs.
Executing the init script with <code>source</code> is required to export environment variables to the current shell session.</p>

<p>Because the script dir is added to PATH, no path needs to be added
when logging a timestamp :</p>

<p><code>timestamp.sh eventname</code></p>

<p>This will log the current timestamp to a file and display it on STDOUT.
Repeat this step as much as needed.</p>

<p>When finished, run </p>

<p><code>analyse.sh</code></p>

<p>to analyse the logfile with timestamps and print out the results.
It will calculate the duration between the timestamps and add them to
a file with the analysed data of previous builds.
When Keen.io is enabled, the data will be sent to your Keen.io project for analysis.
When run on Travis CI, it will automatically add build/job related info.</p>

<p>To generate a graph from previous builds, run</p>

<p><code>generate_trend.py</code></p>

<p>It will take the file with analysed data generated by the analyse script and turn it into a trend graph and saves this graph.</p>

<p>Use the <code>sync-buildtime-trend-with-gh-pages.sh</code> script when you run it as part of a Travis CI build. See below for details.</p>

<h2>
<a name="store-build-time-data-in-keenio" class="anchor" href="#store-build-time-data-in-keenio"><span class="octicon octicon-link"></span></a>Store build time data in Keen.io</h2>

<p>Next to storing your build time data in xml, it can be sent to Keen.io for storage, analysis and generating graphs.</p>

<p>Follow these steps to enable using Keen.io :</p>

<ol>
<li>
<a href="https://keen.io/signup">Create a Keen.io account</a>, if you haven't already done so.</li>
<li>
<a href="https://keen.io/add-project">Create a project</a> in you keen.io account.</li>
<li>Look up the <code>project ID</code> and <code>Write Key</code> and assign them to environment variables : </li>
<li><code>export KEEN_PROJECT_ID=&lt;Project ID&gt;</code></li>
<li><code>export KEEN_WRITE_KEY=&lt;Write Key&gt;</code></li>
</ol><p>If these environment variables are set, the scripts will detect this and use Keen.io to store data and do analysis.</p>

<h2>
<a name="integrate-with-travis-ci" class="anchor" href="#integrate-with-travis-ci"><span class="octicon octicon-link"></span></a>Integrate with Travis CI</h2>

<p>You can integrate Buildtime Trend with your build process on Travis CI :
install and initialise the buildtime trend scripts, add timestamp labels, generate the trend
and synchronise it with your gh-pages branch.</p>

<p>All you need is a github repo, a travis account for your repo and a gh-pages branch to publish the results.</p>

<p>You also need to create an encrypted GH_TOKEN to get write access to your repo (publish results on gh-pages branch) :</p>

<ul>
<li>
<a href="https://github.com/settings/applications">create</a> the access token for your github repo, <code>repo</code> scope is sufficient</li>
<li>encrypt the environment variable using the <a href="http://docs.travis-ci.com/user/encryption-keys/">travis tool</a> :
<code>travis encrypt GH_TOKEN=github_access_token</code>
</li>
<li>add the encrypted token to your .travis.yml file (see below)</li>
</ul><p>To enable integration with Keen.io, <code>KEEN_PROJECT_ID</code> and <code>KEEN_WRITE_KEY</code> should be set (see above):</p>

<ol>
<li>Follow the steps above to create a Keen.io account and project and look up the Project ID</li>
<li>Encrypt the project ID using the <a href="http://docs.travis-ci.com/user/encryption-keys/">travis tool</a> :
<code>travis encrypt KEEN_PROJECT_ID=&lt;Project ID&gt;</code> and add it to .travis.yml (see below)</li>
<li>For the Write key, the master key of your Keen.io project should be used, because the Write key is too long to encrypt using the Travis encryption tool :
<code>travis encrypt KEEN_WRITE_KEY=&lt;Master Key&gt;</code>
</li>
<li>The master key of your Keen.io project is used to generate a scoped read key:
<code>travis encrypt KEEN_MASTER_KEY=&lt;Master Key&gt;</code>
</li>
</ol><p>Another option is to export the API master key, generate a scoped key using the Keen.io <a href="https://github.com/keenlabs/KeenClient-Python#create-scoped-keys">Python SDK</a> and use those keys for write and read access.</p>

<p>The generated trend graph and build-data will be put in folder <code>buildtime-trend</code> on your <code>gh-pages</code> branch.
The trend is available on http://{username}.github.io/{repo_name}/buildtime-trend/trend.png</p>

<p>Example <code>.travis.yml</code> file :</p>

<pre><code>language: python
env:
  global:
    - secure: # your secure GH_TOKEN goes here (required to share trend on gh-pages)
    - secure: # your secure KEEN_PROJECT_ID goes here (required to store data on Keen.io)
    - secure: # your secure KEEN_WRITE_KEY goes here (required to store data on Keen.io)
    - secure: # your secure KEEN_MASTER_KEY goes here (required to generate a scoped read key to generate graphs using the Keen.io API)
before_install:
  # install and initialise build-trend scripts
  - if [[ -d $HOME/buildtime-trend/.git ]]; then cd $HOME/buildtime-trend; git pull; cd ..; else git clone https://github.com/ruleant/buildtime-trend.git $HOME/buildtime-trend; fi
  # initialise buildtime-trend scripts
  - source $HOME/buildtime-trend/init.sh
install:
  # generate timestamp with label 'install'
  - timestamp.sh install
  # install buildtime-trend dependencies
  - CFLAGS="-O0" pip install -r ${BUILD_TREND_HOME}/requirements.txt
  # install dependencies
script:
  # generate timestamp with label 'tests'
  - timestamp.sh tests
  # run your tests
after_success:
  # generate timestamp with label 'after_success'
  - timestamp.sh after_success
  # after_success scripts
after_script:
  # synchronise buildtime-trend result with gh-pages
  - sync-buildtime-trend-with-gh-pages.sh
</code></pre>

<h2>
<a name="bugs-and-feature-requests" class="anchor" href="#bugs-and-feature-requests"><span class="octicon octicon-link"></span></a>Bugs and feature requests</h2>

<p>Please report bugs and add feature requests in the Github <a href="https://github.com/ruleant/buildtime-trend/issues">issue tracker</a>.</p>

<h2>
<a name="contact" class="anchor" href="#contact"><span class="octicon octicon-link"></span></a>Contact</h2>

<p>Follow us on <a href="https://twitter.com/buildtime_trend">Twitter</a> and <a href="https://www.ohloh.net/p/buildtime-trend">Ohloh</a>.</p>
      </section>
    </div>

    <!-- FOOTER  -->
    <div id="footer_wrap" class="outer">
      <footer class="inner">
        <p class="copyright">Buildtime trend maintained by <a href="https://github.com/ruleant">ruleant</a></p>
        <p>Published with <a href="http://pages.github.com">GitHub Pages</a></p>
      </footer>
    </div>

              <script type="text/javascript">
            var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
            document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
          </script>
          <script type="text/javascript">
            try {
              var pageTracker = _gat._getTracker("UA-49318924-1");
            pageTracker._trackPageview();
            } catch(err) {}
          </script>


  </body>
</html>
